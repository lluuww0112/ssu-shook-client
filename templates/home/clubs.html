<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ë§ì¶¤í˜• ë™ì•„ë¦¬ ì¶”ì²œ</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: #a8dadc;
        background-image: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.15) 20%,
          transparent 20%
        );
        background-size: 30px 30px;
        margin: 0;
        padding: 30px;
      }

      /* ìŠ¬ë¼ì´ë“œ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
      #my-club-list {
        position: fixed;
        top: 0;
        left: -250px; /* ìˆ¨ê¹€ ìƒíƒœ */
        width: 250px;
        height: 100%;
        background-color: #ffffff;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        padding: 20px;
        overflow-y: auto;
        transition: left 0.3s ease;
        z-index: 1001;
      }

      #my-club-list:hover {
        left: 0; /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ í‘œì‹œ */
      }

      #my-club-list h3 {
        margin-top: 0;
        font-size: 18px;
        color: #4b4b8f;
      }

      #my-club-list ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      #my-club-list li {
        margin-bottom: 15px;
        font-size: 14px;
        color: #333;
      }

      #my-club-list li strong {
        font-size: 16px;
        color: #6c5ce7;
      }

      #content {
        position: relative;
        z-index: 1;
        transition: filter 0.3s ease;
      }

      #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.825); /* ì–´ë‘ìš´ ë°°ê²½ */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        z-index: 1000;
      }

      #my-club-list:hover ~ #overlay {
        opacity: 1;
        visibility: visible; /* ìŠ¬ë¼ì´ë“œ ë©”ë‰´ê°€ ì—´ë¦´ ë•Œ ì˜¤ë²„ë ˆì´ í‘œì‹œ */
      }

      #my-club-list:hover ~ #content {
        filter: none; /* ë§ì¶¤í˜• ë™ì•„ë¦¬ ì„¹ì…˜ì€ ë°°ê²½ì´ ë°”ë€Œì§€ ì•Šë„ë¡ */
      }

      .page {
        max-width: 800px;
        margin: auto;
        background: #ffffff;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 1;
      }

      h2 {
        text-align: center;
        margin-bottom: 30px;
      }

      #club-list {
        display: flex;
        flex-wrap: wrap;
        gap: 20px; /* ì¹´ë“œ ê°„ê²© */
        justify-content: center;
      }

      .club {
        flex: 1 1 calc(33.333% - 20px); /* 3ì—´ ë ˆì´ì•„ì›ƒ */
        max-width: calc(33.333% - 20px);
        box-sizing: border-box;
        margin-bottom: 20px;
        padding: 20px;
        border-radius: 10px;
        background: linear-gradient(135deg, #e0e7ff, #f5f4ff);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      @media (max-width: 768px) {
        .club {
          flex: 1 1 calc(50% - 20px); /* 2ì—´ ë ˆì´ì•„ì›ƒ (í™”ë©´ì´ ì¢ì„ ë•Œ) */
          max-width: calc(50% - 20px);
        }
      }

      @media (max-width: 480px) {
        .club {
          flex: 1 1 100%; /* 1ì—´ ë ˆì´ì•„ì›ƒ (í™”ë©´ì´ ë” ì¢ì„ ë•Œ) */
          max-width: 100%;
        }
      }

      .club:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .club h3 {
        margin-bottom: 10px;
        font-size: 20px;
        color: #4b4b8f;
        font-weight: bold;
      }

      .club p {
        margin: 5px 0;
        font-size: 14px;
        color: #333;
      }

      .club p span {
        font-weight: bold;
        color: #6c5ce7;
      }

      .avg-rating {
        font-size: 15px;
        color: #ff9800;
        margin-bottom: 10px;
        font-weight: bold;
      }

      textarea {
        width: 100%;
        margin-top: 10px;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        resize: vertical;
      }

      .stars span {
        font-size: 24px;
        cursor: pointer;
        color: lightgray;
      }

      .stars span.active {
        color: gold;
      }

      button {
        margin-top: 10px;
        padding: 8px 16px;
        background-color: #6c5ce7;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 15px;
      }

      .review-box {
        margin-top: 15px;
      }

      .review {
        background: #f0f0f0;
        padding: 10px;
        border-radius: 6px;
        font-size: 15px;
        margin-bottom: 12px;
      }

      .review-footer {
        font-size: 13px;
        color: gray;
        margin-top: 5px;
      }

      .review-actions {
        margin-top: 8px;
        display: flex;
        gap: 12px;
      }

      .review-actions span {
        font-size: 14px;
        color: #6c5ce7;
        cursor: pointer;
      }

      .back-button {
        display: block;
        margin: 40px auto 0;
        padding: 10px 20px;
        background-color: #6c5ce7;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
      }

      .error-message {
        color: red;
        font-size: 14px;
        margin-top: 8px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="my-club-list">
      <h3>ë‚´ ë™ì•„ë¦¬</h3>
      <ul>
        <!-- ë™ì•„ë¦¬ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </ul>
      <button
        id="logoutButton"
        style="
          margin-top: 20px;
          padding: 10px 20px;
          background-color: #ff6b6b;
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 14px;
          width: 80%;
        "
      >
        ë¡œê·¸ì•„ì›ƒ
      </button>
    </div>

    <div id="overlay"></div>
    <!-- ì–´ë‘ìš´ ë°°ê²½ ì˜¤ë²„ë ˆì´ -->

    <div id="content">
      <div class="page">
        <h2>ë§ì¶¤í˜• ë™ì•„ë¦¬ ì¶”ì²œ</h2>
        <input
          type="search"
          id="search-bar"
          placeholder="ë™ì•„ë¦¬ ì´ë¦„ ë˜ëŠ” ë¶„ê³¼ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”"
          oninput="filterClubs()"
          style="
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid #ccc;
          "
        />
        <div id="club-list">
          <!-- ë™ì•„ë¦¬ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
        <button class="back-button" onclick="goBack()">â¬…ï¸ ëŒì•„ê°€ê¸°</button>
      </div>
    </div>

    <script>
      let allClubs = []; // ëª¨ë“  ë™ì•„ë¦¬ ë°ì´í„°ë¥¼ ì €ì¥

      async function fetchClubs() {
        try {
          const response = await fetch("http://127.0.0.1:3000/user/get_club", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ club_name: null }),
          });

          const data = await response.json();

          if (data.status === 1) {
            allClubs = data.results; // ë°ì´í„°ë¥¼ ì €ì¥
            renderClubList(allClubs);
          } else {
            alert("ë™ì•„ë¦¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ë™ì•„ë¦¬ ì •ë³´ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          alert("ë™ì•„ë¦¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      async function fetchMyClubs() {
        try {
          const userName = localStorage.getItem("userName");
          const response = await fetch(
            `http://127.0.0.1:3000/user/get_my_club/${userName}`
          );
          const data = await response.json();

          if (data.status === 1) {
            const myClubList = document.querySelector("#my-club-list ul");
            myClubList.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš©ì„ ì´ˆê¸°í™”

            data.results.forEach((club) => {
              const li = document.createElement("li");
              li.innerHTML = `
                <strong>${club.club_name}</strong><br>
                <span style="font-size: 14px; color: gray;">${club.category}</span>
              `;
              li.style.cursor = "pointer"; // í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ìŠ¤íƒ€ì¼ ì¶”ê°€
              li.addEventListener("click", () => {
                localStorage.setItem("club", club.club_name); // í´ë¦­í•œ ë™ì•„ë¦¬ ì´ë¦„ ì €ì¥
                window.location.href = "./clubs/club"; // í˜ì´ì§€ ì „í™˜
              });
              myClubList.appendChild(li);
            });
          } else {
            alert("ë‚´ ë™ì•„ë¦¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ë‚´ ë™ì•„ë¦¬ ì •ë³´ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          alert("ë‚´ ë™ì•„ë¦¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      function renderClubList(clubs) {
        const clubList = document.getElementById("club-list");
        clubList.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš©ì„ ì´ˆê¸°í™”

        clubs.forEach((club) => {
          const clubElement = document.createElement("div");
          clubElement.className = "club";
          clubElement.innerHTML = `
            <h3>ğŸ“Œ ${club.club_name}</h3>
            <p><span>${club.category}</span></p>
            <p>í™œë™ íšŸìˆ˜: <span>${club.activity}</span></p>
            <p>í‰ì : <span>${club.rating}</span></p>
            <p>ì ìˆ˜: <span>${club.score}</span></p>
          `;
          clubElement.style.cursor = "pointer"; // í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ìŠ¤íƒ€ì¼ ì¶”ê°€
          clubElement.addEventListener("click", () => {
            localStorage.setItem("club", club.club_name); // í´ë¦­í•œ ë™ì•„ë¦¬ ì´ë¦„ ì €ì¥
            window.location.href = "./clubs/club"; // í˜ì´ì§€ ì „í™˜
          });
          clubList.appendChild(clubElement);
        });
      }

      function filterClubs() {
        const query = document.getElementById("search-bar").value.toLowerCase();
        const filteredClubs = allClubs.filter(
          (club) =>
            club.club_name.toLowerCase().includes(query) ||
            club.category.toLowerCase().includes(query)
        );
        renderClubList(filteredClubs);
      }

      function goBack() {
        window.history.back();
      }

      // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      document.getElementById("logoutButton").addEventListener("click", () => {
        localStorage.clear(); // localStorage ì´ˆê¸°í™”
        window.location.href = "./"; // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë™ì•„ë¦¬ ëª©ë¡ ë° ë‚´ ë™ì•„ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      document.addEventListener("DOMContentLoaded", () => {
        fetchClubs();
        fetchMyClubs();
      });
    </script>
  </body>
</html>
